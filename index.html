<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Orçamento Simples</title>
    <!-- Link para o arquivo manifest.json para PWA -->
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            font-family: 'Inter', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5; /* Fundo mais suave */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            padding: 25px;
            border-radius: 16px; /* Cantos mais arredondados */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08); /* Sombra mais suave */
            max-width: 800px;
            width: 100%;
            box-sizing: border-box;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px; /* Ajuste a margem para o novo campo */
            font-size: 1.8em;
            font-weight: 600; /* Um pouco mais leve */
        }
        .company-info {
            margin-bottom: 25px;
            text-align: center;
        }
        .company-info label {
            display: block;
            margin-bottom: 8px;
            font-size: 1em;
            color: #555;
            font-weight: bold;
        }
        .company-info input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            font-size: 1em;
            box-sizing: border-box;
            height: 45px;
        }
        .logo-input-group {
            margin-top: 15px;
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #e8e8e8;
            border-radius: 12px;
            background-color: #fcfcfc;
        }
        .logo-input-group .radio-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        .logo-input-group .radio-option {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .logo-input-group .radio-option input[type="radio"] {
            margin-right: 8px;
            cursor: pointer;
        }
        .logo-input-group .logo-input-fields {
            margin-top: 10px;
        }
        .logo-input-group .logo-input-fields label {
            text-align: left;
            margin-bottom: 5px;
        }
        .logo-input-group .logo-input-fields input[type="text"],
        .logo-input-group .logo-input-fields input[type="file"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            font-size: 0.95em;
            box-sizing: border-box;
            height: 40px;
            margin-bottom: 10px;
        }
        .logo-display-area {
            margin-top: 10px;
            padding: 10px;
            border: 1px dashed #ccc;
            border-radius: 8px;
            min-height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f9f9f9;
        }
        .logo-display-area img {
            max-width: 100%;
            max-height: 80px; /* Limita a altura do logo para não distorcer o layout */
            height: auto;
            border-radius: 8px;
            display: none; /* Esconde a imagem por padrão até que um URL seja válido */
        }
        .product-item {
            display: flex;
            flex-wrap: nowrap; /* Impede que os itens quebrem a linha */
            align-items: flex-end; /* Alinha os itens na parte inferior */
            margin-bottom: 15px;
            gap: 5px; /* Espaçamento entre os itens bem menor */
            padding: 12px; /* Um pouco mais de padding */
            border: 1px solid #e8e8e8; /* Borda mais clara */
            border-radius: 10px; /* Cantos mais arredondados */
            background-color: #fdfdfd; /* Fundo mais claro */
            position: relative;
            overflow-x: hidden; /* Remove explicitamente o scroll horizontal */
        }
        .product-item input[type="text"] {
            padding: 10px;
            border: 1px solid #dcdcdc; /* Borda mais clara */
            border-radius: 8px; /* Cantos mais arredondados */
            font-size: 0.95em;
            box-sizing: border-box;
            height: 40px;
        }
        .product-item .product-description {
            flex: 1; /* Permite crescer e ocupar o espaço restante */
            min-width: 55%; /* Garante largura mínima para a descrição */
        }
        .product-item .total-display {
            flex: 0 0 60px; /* Largura base ajustada para ser menor */
            padding: 10px 5px; /* Reduz padding horizontal */
            background-color: #f2f2f2; /* Fundo mais suave */
            border: 1px solid #d0d0d0; /* Borda mais suave */
            border-radius: 8px; /* Cantos mais arredondados */
            text-align: right;
            font-weight: bold;
            color: #555;
            min-width: 50px; /* Garante que não fique muito pequeno */
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }
        .product-item label {
            font-size: 0.75em; /* Reduzindo um pouco o tamanho da fonte da label */
            color: #6a6a6a; /* Cor de texto um pouco mais suave */
            margin-bottom: 3px; /* Reduzindo a margem inferior */
            width: 100%;
            display: block;
            text-align: center; /* Centraliza a label sobre o input */
        }
        .product-item div.input-group {
            display: flex;
            flex-direction: column;
            flex: 0 0 10%; /* Largura base para Qtd, Valor, Acréscimo (45px) */
            align-items: center; /* Centraliza o input dentro do group */
        }
        .product-item input[type="number"] {
            width: 100%; /* Faz o input preencher a largura do seu input-group */
            padding: 5px 3px; /* Reduzindo o padding para caber mais números */
            text-align: center; /* Centraliza o texto do número */
        }

        .delete-product {
            background-color: #ff6b6b; /* Vermelho mais suave */
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 0.9em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -10px;
            right: -10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15); /* Sombra mais suave */
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        .delete-product:hover {
            background-color: #ff4757; /* Vermelho um pouco mais forte no hover */
            transform: scale(1.05);
        }

        .add-product {
            background-color: #3cb371; /* Verde mais suave */
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            display: block;
            width: 100%;
            margin: 25px 0;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2); /* Sombra sutil */
        }
        .add-product:hover {
            background-color: #2e8b57; /* Verde mais forte no hover */
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.3);
        }
        .delivery-section, .discount-section, .pix-info, .credit-card-info {
            margin-top: 25px;
            padding: 20px;
            background-color: #fcfcfc; /* Fundo mais claro */
            border: 1px solid #e8e8e8; /* Borda mais clara */
            border-radius: 12px; /* Cantos mais arredondados */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); /* Sombra mais suave */
        }
        .delivery-section label, .delivery-section input,
        .discount-section label, .discount-section input,
        .pix-info label, .pix-info input, .pix-info select {
            display: block;
            margin-bottom: 15px;
        }
        .delivery-section input,
        .discount-section input,
        .pix-info input, .pix-info select {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            margin-top: 5px;
            font-size: 0.95em;
            box-sizing: border-box;
        }
        .summary {
            margin-top: 30px;
            border-top: 2px solid #e0e0e0; /* Borda mais clara */
            padding-top: 20px;
        }
        .summary div {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 1.15em;
        }
        .summary div strong {
            color: #333;
        }
        .total-pay strong {
            font-size: 1.5em;
            color: #007BFF;
            font-weight: bold;
        }
        .credit-card-info p {
            font-size: 0.9em;
            color: #888; /* Cor de texto mais suave */
            text-align: center;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 30px;
        }
        .print-button, .save-button, .load-button {
            flex: 1;
            background-color: #007BFF;
            color: white;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            box-sizing: border-box;
            text-align: center;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            min-width: 120px;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2); /* Sombra sutil */
        }
        .print-button:hover, .save-button:hover, .load-button:hover {
            background-color: #0056b3;
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.3);
        }
        .save-button {
            background-color: #ffa040; /* Laranja mais suave */
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.2);
        }
        .save-button:hover {
            background-color: #e68900;
            box-shadow: 0 6px 15px rgba(255, 152, 0, 0.3);
        }
        .load-button {
            background-color: #8a63d2; /* Roxo mais suave */
            box-shadow: 0 4px 10px rgba(103, 58, 183, 0.2);
        }
        .load-button:hover {
            background-color: #724cb8;
            box-shadow: 0 6px 15px rgba(103, 58, 183, 0.3);
        }

        /* New buttons styling */
        .top-buttons-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
            justify-content: center; /* Centraliza os botões */
        }
        .top-buttons-group button {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            box-sizing: border-box;
            text-align: center;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            min-width: 20%; /* Garante que os botões não fiquem muito pequenos */
        }
        .new-budget-button {
            background-color: #dc3545; /* Vermelho para "Novo Orçamento" */
            color: white;
            box-shadow: 0 4px 10px rgba(220, 53, 69, 0.2);
        }
        .new-budget-button:hover {
            background-color: #c82333;
            box-shadow: 0 6px 15px rgba(220, 53, 69, 0.3);
        }
        .reload-values-button {
            background-color: #17a2b8; /* Azul ciano para "Recarregar Valores" */
            color: white;
            box-shadow: 0 4px 10px rgba(23, 162, 184, 0.2);
        }
        .reload-values-button:hover {
            background-color: #138496;
            box-shadow: 0 6px 15px rgba(23, 162, 184, 0.3);
        }

        /* A2HS Button */
        #install-app-button {
            display: none; /* Hidden by default */
            background-color: #6f42c1; /* Roxo */
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            margin-top: 20px;
            width: 100%;
            box-sizing: border-box;
            box-shadow: 0 4px 10px rgba(111, 66, 193, 0.2);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        #install-app-button:hover {
            background-color: #5a359a;
            box-shadow: 0 6px 15px rgba(111, 66, 193, 0.3);
        }

        /* WhatsApp Support Button */
        .whatsapp-support-container {
            margin-top: 30px;
            text-align: center;
        }
        .whatsapp-support-button {
            background-color: #25D366; /* Verde WhatsApp */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            display: inline-flex; /* Para alinhar o ícone e texto */
            align-items: center;
            gap: 8px; /* Espaçamento entre ícone e texto */
            box-shadow: 0 4px 10px rgba(37, 211, 102, 0.2);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        .whatsapp-support-button:hover {
            background-color: #1DA851;
            box-shadow: 0 6px 15px rgba(37, 211, 102, 0.3);
        }
        .whatsapp-support-button svg {
            width: 20px;
            height: 20px;
            fill: white; /* Cor do ícone */
        }

        /* LLM Generated Content */
        .llm-output-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #e9f7ef; /* Fundo verde claro */
            border: 1px solid #c3e6cb; /* Borda verde */
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: none; /* Hidden by default */
        }
        .llm-output-section h3 {
            text-align: center;
            color: #28a745; /* Verde mais escuro */
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        .llm-output-section pre {
            background-color: #ffffff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            white-space: pre-wrap; /* Quebra de linha para texto longo */
            word-wrap: break-word; /* Quebra de palavra para texto longo */
            font-family: 'Inter', Arial, sans-serif;
            font-size: 0.9em;
            color: #333;
            max-height: 300px; /* Limita a altura para scroll */
            overflow-y: auto;
        }
        .llm-output-section .copy-button {
            background-color: #007BFF;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            display: block;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            transition: background-color 0.3s ease;
        }
        .llm-output-section .copy-button:hover {
            background-color: #0056b3;
        }
        .llm-loading-indicator {
            display: none;
            text-align: center;
            margin-top: 20px;
            font-style: italic;
            color: #666;
        }


        /* Estilos para impressão */
        @media print {
            /* Força a impressão de cores e fundos */
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }

            body {
                margin: 0;
                padding: 0;
                background-color: #fff !important; /* Força fundo branco */
                font-size: 12pt;
            }
            .container {
                box-shadow: none !important;
                border-radius: 0 !important;
                padding: 10px !important;
                max-width: none !important;
                margin: 0 !important;
            }
            h1 {
                font-size: 1.5em !important;
                margin-bottom: 20px !important;
            }
            .company-info {
                text-align: center !important;
                margin-bottom: 15px !important;
            }
            .company-info label,
            .company-info input {
                display: none !important; /* Oculta a label e o input na impressão */
            }
            .company-info .print-only-company-name {
                display: block !important;
                font-size: 1.2em !important;
                font-weight: bold !important;
                margin-bottom: 10px !important;
            }
            /* Ensure logo is visible */
            .print-only-logo {
                display: block !important;
                margin-bottom: 15px !important; /* Add some space below the logo */
            }
            .print-only-logo img {
                display: block !important;
                max-width: 150px !important; /* Ensure it's not too big */
                max-height: 80px !important; /* Ensure it's not too tall */
                margin: 0 auto !important; /* Center the image */
            }

            .logo-input-group, /* Oculta todo o grupo de input de logo online */
            .logo-input-group .radio-options,
            .logo-input-group .logo-input-fields {
                display: none !important;
            }
            .top-buttons-group, /* Oculta os novos botões na impressão */
            #install-app-button, /* Oculta o botão de instalação na impressão */
            .whatsapp-support-container, /* Oculta o botão de WhatsApp na impressão */
            .llm-output-section, /* Oculta a seção de saída do LLM na impressão */
            .add-product,
            .summary .subtotal,
            .summary .additional-value,
            .delivery-cost-summary, /* Oculta o resumo de entrega online */
            .discount-amount-summary, /* Oculta o resumo de desconto online */
            .pix-info .online-only,
            .delivery-section .online-only,
            .discount-section .online-only,
            .button-group,
            .credit-card-info,
            .delete-product
            {
                display: none !important;
            }

            /* Oculta os inputs e os grupos de input de cada item na impressão */
            .product-item input,
            .product-item .input-group,
            .product-item .total-display {
                display: none !important;
            }

            .product-item {
                display: block !important; /* Use block for each item to stack them */
                border-bottom: 1px dashed #eee !important; /* Separador para itens */
                padding-bottom: 5px !important;
                margin-bottom: 10px !important;
                background: none !important; /* Remove background */
                border: none !important; /* Remove borders */
                box-shadow: none !important; /* Remove shadows */
                overflow: hidden !important; /* Clear floats */
            }
            /* Exibe o novo contentor para os detalhes do item na impressão */
            .product-item .print-only-item-details {
                display: flex !important; /* Use flexbox for internal layout */
                justify-content: space-between !important;
                align-items: flex-start !important; /* Align to top for multi-line descriptions */
                width: 100% !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            .product-item .print-only-description-qty { /* Novo span para descrição + quantidade */
                display: block !important; /* Block within flex item */
                flex: 1 !important; /* Takes available space */
                font-weight: bold !important;
                font-size: 1em !important;
                color: #333 !important;
                margin-right: 10px !important;
                word-wrap: break-word !important;
                box-sizing: border-box !important;
            }
            .product-item .print-only-item-total {
                display: block !important; /* Block within flex item */
                flex-shrink: 0 !important; /* Don't shrink */
                width: 80px !important; /* Fixed width for the total */
                font-weight: bold !important;
                font-size: 1em !important;
                color: #333 !important;
                text-align: right !important;
                box-sizing: border-box !important;
            }

            .summary {
                border-top: 1px dashed #ccc !important;
                padding-top: 10px !important;
                margin-top: 10px !important;
            }
            .summary div {
                font-size: 1em !important;
                padding: 3px 0 !important;
            }
             .total-pay {
                font-weight: bold !important;
                margin-top: 15px !important;
                border-top: 1px solid #000 !important;
                padding-top: 10px !important;
            }
            .pix-info, .delivery-section, .discount-section, .credit-card-info {
                display: block !important;
                background-color: #fff !important;
                border: none !important; /* Remove borda na impressão */
                box-shadow: none !important; /* Remove sombra na impressão */
                padding: 0 !important;
                margin-top: 15px !important;
            }
             .pix-info label, .delivery-section label, .discount-section label {
                display: inline !important;
                font-weight: bold !important;
                margin-right: 5px !important;
            }
            .pix-info .print-only, .delivery-section .print-only, .discount-section .print-only {
                display: block !important;
            }

            /* Força a exibição dos novos totais na impressão */
            .summary #gross-total-print-info,
            .summary #discount-amount-print-info {
                display: flex !important;
            }
        }

        /* Responsividade para telas menores */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
            .product-item {
                flex-direction: column; /* Em telas muito pequenas, volta a empilhar */
                align-items: stretch;
            }
            .product-item input[type="text"],
            .product-item input[type="number"],
            .product-item .total-display {
                width: 100%;
                margin-bottom: 10px;
            }
            .product-item div.input-group {
                width: 100%;
                margin-bottom: 10px;
            }
            .button-group, .top-buttons-group {
                flex-direction: column;
            }
            .print-button, .save-button, .load-button, .new-budget-button, .reload-values-button, #install-app-button, .whatsapp-support-button, .llm-generate-button {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>FORMULÁRIO DE ORÇAMENTO SIMPLES</h1>
        <div class="top-buttons-group">
            <button class="new-budget-button" onclick="newBudget()">Novo Orçamento</button>
            <button class="reload-values-button" onclick="reloadValues()">Recarregar Valores</button>
        </div>
        <div class="company-info">
            <label for="company-name">Nome da Empresa / CNPJ / Contato:</label>
            <input type="text" id="company-name" placeholder="Digite o nome, CNPJ e o contato da empresa">
            <div class="print-only-company-name" style="display:none;"></div>
        </div>

        <div class="logo-input-group">
            <div class="radio-options">
                <label class="radio-option">
                    <input type="radio" name="logo-source-type" value="url" id="radio-logo-url" checked> URL do Logo
                </label>
                <label class="radio-option">
                    <input type="radio" name="logo-source-type" value="file" id="radio-logo-file"> Upload de Arquivo Local
                </label>
            </div>

            <div id="logo-url-fields" class="logo-input-fields">
                <label for="logo-url-input">URL do Logo da Empresa:</label>
                <input type="text" id="logo-url-input" placeholder="Cole aqui o endereço da imagem do seu logo (ex: https://seusite.com/logo.png)">
            </div>

            <div id="logo-file-fields" class="logo-input-fields" style="display: none;">
                <label for="logo-file-input">Selecione o arquivo do Logo:</label>
                <input type="file" id="logo-file-input" accept="image/*">
            </div>

            <div class="logo-display-area">
                <img id="company-logo" src="" alt="Logo da Empresa">
            </div>
        </div>

        <button id="install-app-button">Adicionar à Tela Inicial</button>

        <div id="product-list">
            <div class="product-item">
                <input type="text" class="product-description" placeholder="Descrição do Produto">
                <div class="input-group">
                    <label>Qtd:</label>
                    <input type="number" class="quantity-input" value="1" min="1">
                </div>
                <div class="input-group">
                    <label>Valor (R$):</label>
                    <input type="number" class="value-input" placeholder="0.00" step="0.01">
                </div>
                <div class="input-group">
                    <label>acr. (%):</label>
                    <input type="number" class="percentage-input" value="0" min="0"> <!-- Changed default to 0 -->
                </div>
                <div class="total-display">R$ 0,00</div>
                <button class="delete-product">X</button>
                <!-- Print-only container for individual item details -->
                <div class="print-only-item-details" style="display:none;">
                    <span class="print-only-description-qty"></span>
                    <span class="print-only-item-total"></span>
                </div>
            </div>
        </div>

        <button class="add-product" onclick="addProduct()">Adicionar Produto</button>

        <div class="delivery-section">
            <h3 class="online-only">Informações de Entrega:</h3>
            <label class="online-only" for="distance">Distância (KM):</label>
            <input class="online-only" type="number" id="distance" placeholder="0" step="0.1">

            <label class="online-only" for="price-per-km">Valor por KM (R$):</label>
            <input class="online-only" type="number" id="price-per-km" placeholder="0.00" step="0.01">

            <div class="print-only" id="delivery-print-info" style="display:none;">
                <p><strong>Valor de Entrega:</strong> R$ <span class="delivery-cost-display">0,00</span></p>
            </div>
        </div>

        <div class="discount-section">
            <h3 class="online-only">Desconto (Pix):</h3>
            <label class="online-only" for="pix-discount-percentage">Desconto no Pix (%):</label>
            <input class="online-only" type="number" id="pix-discount-percentage" placeholder="0" min="0" max="100" step="0.1">

            <div class="print-only" id="discount-print-info" style="display:none;">
                <p><strong>Desconto Pix:</strong> <span class="discount-percentage-display">0%</span></p>
            </div>
        </div>

        <div class="summary">
            <!-- Online view elements (hidden in print) -->
            <div class="subtotal online-only">
                <span>Subtotal (Itens):</span>
                <strong>R$ <span id="subtotal">0,00</span></strong>
            </div>
            <div class="additional-value online-only">
                <span>acr. Total:</span>
                <strong>R$ <span id="additional-value">0,00</span></strong>
            </d